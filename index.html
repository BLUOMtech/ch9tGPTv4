<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ch9tGPT Ultimate</title>
<style>
body {margin:0;padding:0;font-family:Arial,sans-serif;background:#0d0f14;color:white;}
#app{max-width:600px;margin:auto;padding:20px;}
h1{text-align:center;margin-bottom:10px;}
#messages{background:#1a1c22;padding:15px;border-radius:8px;height:350px;overflow-y:auto;margin-bottom:10px;border:1px solid #333;}
.msg{margin-bottom:12px;padding:10px;border-radius:6px;max-width:80%;word-break:break-word;}
.user{background:#2d75ff;margin-left:auto;}
.bot{background:#2e2e38;margin-right:auto;}
#input-area{display:flex;gap:10px;margin-bottom:10px;}
#userInput{flex:1;padding:12px;border-radius:6px;border:none;font-size:16px;}
#sendBtn{padding:12px 20px;background:#2d75ff;border:none;border-radius:6px;color:#fff;font-size:16px;cursor:pointer;}
#sendBtn:hover{background:#1f5fe0;}
#fileInput{margin-bottom:10px;}
.output-area, #devPanel{background:#1a1c22;padding:10px;margin-top:5px;border-radius:6px;overflow:auto;max-height:150px;}
.code-block{background:#2b2b3a;padding:8px;border-radius:4px;white-space:pre-wrap;font-family:monospace;margin-top:5px;}
img.upload-preview{max-width:100%;border-radius:6px;margin-top:5px;}
</style>
</head>
<body>
<div id="app">
<h1>ch9tGPT Ultimate</h1>
<div id="messages"></div>
<div id="input-area">
<input id="userInput" placeholder="Type a message..." />
<button id="sendBtn">Send</button>
</div>
<input type="file" id="fileInput" multiple />
<div class="output-area" id="fileOutput"></div>
<h3>Developer Panel</h3>
<div id="devPanel"></div>
</div>

<script>
class Ch9tGPT {
  constructor(){
    this.memory=[];
    this.fileData=[];
    this.IP=300;
    this.personalities={
      Classic:{name:"BLUOM Classic",mood:"calm",style:"professional"},
      HyperFriendly:{name:"BLUOM HyperFriendly",mood:"happy",style:"friendly"},
      UltraSmart:{name:"BLUOM UltraSmart",mood:"curious",style:"technical"},
      Sarah:{name:"Sarah",mood:"energetic",style:"friendly"}
    };
    this.currentPersonality="Classic"; // default
    this.devPanel=document.getElementById("devPanel");
  }

  logDev(...args){
    const div=document.createElement("div");
    div.textContent=args.join(" ");
    this.devPanel.appendChild(div);
    this.devPanel.scrollTop=this.devPanel.scrollHeight;
    console.log(...args);
  }

  setPersonality(p){
    if(this.personalities[p]){
      this.currentPersonality=p;
      this.logDev("Personality set to:",this.personalities[p].name);
    }
  }

  remember(text){
    if(!text) return;
    this.memory.push(text);
    if(this.memory.length>50) this.memory.shift();
    this.logDev("Memory updated:",this.memory.slice(-5));
  }

  adjustMood(input){
    const t=input.toLowerCase();
    let mood=this.personalities[this.currentPersonality].mood;
    if(t.includes("hi")||t.includes("hello")) mood="happy";
    if(t.includes("why")||t.includes("how")) mood="curious";
    if(t.includes("fun")) mood="playful";
    if(t.includes("sad")) mood="comforting";
    this.personalities[this.currentPersonality].mood=mood;
  }

  async generateResponse(input){
    // Personality change command
    const cmd=input.trim();
    if(cmd.startsWith("/setPersonality")){
      const p=cmd.split(" ")[1];
      this.setPersonality(p);
      return `‚úÖ Personality switched to ${p}`;
    }

    this.remember(input);
    this.adjustMood(input);

    const t=input.toLowerCase();
    let response="";
    if(t==="hi"||t==="hey"||t==="hello") response="üòÑ Hey! How‚Äôs it going?";
    else if(t.includes("name")) response=`I‚Äôm ${this.personalities[this.currentPersonality].name} ü§ñ What about you?`;
    else if(t.includes("how are you")) response="Feeling great today! üòÑ";
    else if(t.includes("draw")||t.includes("image")) response=this.generateImage(input);
    else if(t.includes("code")||t.includes("python")||t.includes("html")||t.includes("css")) response=this.generateCode(input);
    else{
      let recent=this.memory.slice(-20).join(" ");
      let files=this.fileData.map(f=>f.text).join(" ");
      let combined=`${recent} ${files} ${input}`.replace(/\[object.*?\]/gi,"");
      if(combined.length>this.IP) combined=combined.slice(0,this.IP);
      let mood=this.personalities[this.currentPersonality].mood;
      let emoji="ü§î ";
      if(mood==="happy") emoji="üòÑ ";
      if(mood==="playful") emoji="üòè ";
      if(mood==="comforting") emoji="üíô ";
      // simulate thinking pause
      await new Promise(r=>setTimeout(r,Math.min(1500,combined.length*10)));
      response=emoji+combined.trim();
      if(!/[.!?]$/.test(response)) response+=".";
    }

    this.remember(response);
    this.logDev("Bot response:",response);
    return response;
  }

  generateImage(prompt){return `üñºÔ∏è (Pretend image) Generated for: "${prompt}"`;}
  generateCode(prompt){
    if(prompt.includes("python")) return "```python\nprint('Hello from ch9tGPT')\n```";
    if(prompt.includes("html")) return "```html\n<h1>Hello from ch9tGPT</h1>\n```";
    if(prompt.includes("css")) return "```css\nbody { background:#4af; color:white; }\n```";
    return "```javascript\nconsole.log('Hello from ch9tGPT');\n```";
  }

  async addFile(file){
    return new Promise(resolve=>{
      const reader=new FileReader();
      reader.onload=()=>{
        this.fileData.push({name:file.name,type:file.type,text:reader.result});
        this.logDev("File added:",file.name);
        if(file.type.startsWith("image/")){
          const img=document.createElement("img");
          img.src=reader.result;
          img.className="upload-preview";
          document.getElementById("fileOutput").appendChild(img);
        }
        resolve();
      };
      reader.readAsDataURL(file);
    });
  }
}

window.ch9tGPT=new Ch9tGPT();

// CHAT FUNCTIONS
const messagesDiv=document.getElementById("messages");
const input=document.getElementById("userInput");
const sendBtn=document.getElementById("sendBtn");
const fileInput=document.getElementById("fileInput");

function addMessage(text,sender,isCode=false){
  const div=document.createElement("div");
  div.className="msg "+sender;
  if(isCode){
    const pre=document.createElement("pre");
    pre.className="code-block";
    pre.textContent=text;
    div.appendChild(pre);
  }else div.textContent=text;
  messagesDiv.appendChild(div);
  messagesDiv.scrollTop=messagesDiv.scrollHeight;
}

// SEND MESSAGE
sendBtn.onclick=async()=>{
  let text=input.value.trim();
  if(!text) return;
  addMessage(text,"user");
  input.value="";
  const reply=await window.ch9tGPT.generateResponse(text);
  const isCode=/```/.test(reply);
  addMessage(reply,"bot",isCode);
};

// ENTER KEY
input.addEventListener("keypress",e=>{
  if(e.key==="Enter") sendBtn.click();
});

// FILE UPLOAD
fileInput.addEventListener("change",async e=>{
  document.getElementById("fileOutput").innerHTML="";
  for(const f of e.target.files){
    await window.ch9tGPT.addFile(f);
  }
});
</script>
</body>
</html>